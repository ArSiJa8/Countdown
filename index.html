<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Satisfying Countdown – Beacon</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
:root{--bg:#05070c;--accent:#00ffd5}
*{box-sizing:border-box;font-family:system-ui,sans-serif}
body{
  margin:0;height:100vh;overflow:hidden;
  background:radial-gradient(circle,#0a1220,var(--bg));
  color:white
}
.ui{
  position:absolute;top:20px;width:100%;
  text-align:center;z-index:10;transition:opacity 1s
}
input,button{
  font-size:1rem;padding:.5rem .8rem;border-radius:10px;
  border:none;background:rgba(255,255,255,.12);color:white
}
button{cursor:pointer;margin-left:.4rem}
.time{
  margin-top:.6rem;font-size:1.6rem;
  letter-spacing:.15em;opacity:.7
}
.adv{
  position:fixed;inset:0;display:flex;
  align-items:center;justify-content:center;
  background:radial-gradient(circle,#0ff,#000);
  color:#003;font-size:3rem;font-weight:700;
  opacity:0;pointer-events:none;transition:opacity 1s
}
.adv.show{opacity:1}
canvas{position:fixed;inset:0}

#fsBtn{
  position:fixed;right:16px;bottom:16px;
  padding:10px 14px;border-radius:10px;
  border:none;background:rgba(255,255,255,.14);
  color:#fff;font-size:14px;cursor:pointer;
  backdrop-filter:blur(6px);z-index:20
}
#fsBtn:hover{background:rgba(255,255,255,.28)}
</style>
</head>
<body>

<div class="ui" id="ui">
  <input type="time" id="t">
  <button onclick="start()">Start</button>
  <div class="time" id="out">--:--:--</div>
</div>

<div class="adv" id="adv">✨ ZIEL ERREICHT ✨</div>
<canvas id="c"></canvas>
<button id="fsBtn">⛶ Fullscreen</button>

<script>
const c=document.getElementById('c'),ctx=c.getContext('2d');
let w,h;
function resize(){w=c.width=innerWidth;h=c.height=innerHeight}
addEventListener('resize',resize);resize();

let startMs=null,endMs=null,duration=1,finished=false;
let pauseOffset=0,hiddenAt=null;

function start(){
  const v=t.value;if(!v)return;
  const [hh,mm]=v.split(':').map(Number);
  const now=new Date(),target=new Date();
  target.setHours(hh,mm,0,0);
  if(target<now)target.setDate(target.getDate()+1);

  startMs=Date.now();
  endMs=target.getTime();
  duration=endMs-startMs;
  finished=false;
  pauseOffset=0;hiddenAt=null;
  ui.style.opacity=1;
  adv.classList.remove('show');
}

document.addEventListener("visibilitychange",()=>{
  if(document.hidden){
    hiddenAt=Date.now();
  }else if(hiddenAt){
    pauseOffset+=Date.now()-hiddenAt;
    hiddenAt=null;
  }
});

const ease=t=>t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2;

const beaconParticles=Array.from({length:100},()=>({
  a:Math.random()*Math.PI*2,
  r:Math.random(),v:.002+Math.random()*.004
}));
const party=[];

function drawBeacon(progress,time){
  const angle=-Math.PI/2+progress*Math.PI*2;
  const R=Math.min(w,h)*.42;
  const bx=Math.cos(angle)*R;
  const by=Math.sin(angle)*R;

  // Fortschrittsbogen
  ctx.beginPath();
  ctx.arc(0,0,R,-Math.PI/2,angle);
  ctx.strokeStyle='rgba(0,255,213,.45)';
  ctx.lineWidth=5;
  ctx.shadowColor='rgba(0,255,213,.6)';
  ctx.shadowBlur=12;
  ctx.stroke();
  ctx.shadowBlur=0;

  // Glow-Partikel von Linie
  for(let i=0;i<6;i++){
    const a=-Math.PI/2+Math.random()*(angle+Math.PI/2);
    ctx.fillStyle='rgba(0,255,213,.35)';
    ctx.beginPath();
    ctx.arc(Math.cos(a)*R,Math.sin(a)*R,1.4,0,Math.PI*2);
    ctx.fill();
  }

  // Bahn
  ctx.beginPath();
  ctx.arc(0,0,R,0,Math.PI*2);
  ctx.strokeStyle='rgba(255,255,255,.04)';
  ctx.lineWidth=1;ctx.stroke();

  // Beacon Trail
  beaconParticles.forEach(p=>{
    p.a+=p.v*(1+progress);
    for(let i=3;i>=0;i--){
      const ta=p.a-i*.15;
      ctx.fillStyle=`rgba(0,255,213,${.15-i*.04})`;
      ctx.beginPath();
      ctx.arc(bx+Math.cos(ta)*10,by+Math.sin(ta)*10,1.2,0,Math.PI*2);
      ctx.fill();
    }
  });

  // Beacon
  ctx.fillStyle='rgba(0,255,213,.95)';
  ctx.beginPath();
  ctx.arc(bx,by,4,0,Math.PI*2);
  ctx.fill();
}

function loop(t){
  ctx.fillStyle='rgba(5,7,12,.25)';
  ctx.fillRect(0,0,w,h);
  ctx.save();ctx.translate(w/2,h/2);

  let p=0;
  if(startMs&&endMs){
    const elapsed=Date.now()-startMs-pauseOffset;
    p=Math.min(1,Math.max(0,elapsed/duration));
  }
  const e=ease(p);
  drawBeacon(e,t);

  party.forEach(p=>{
    p.x+=Math.cos(p.a)*p.v;
    p.y+=Math.sin(p.a)*p.v;
    p.v*=.97;p.life--;
    ctx.fillStyle=`rgba(0,255,213,${p.life/100})`;
    ctx.fillRect(p.x-2,p.y-2,4,4);
  });
  for(let i=party.length-1;i>=0;i--)if(party[i].life<=0)party.splice(i,1);

  ctx.restore();

  if(endMs){
    const d=Math.max(0,endMs-Date.now());
    const s=Math.floor(d/1000)%60;
    const m=Math.floor(d/60000)%60;
    const h2=Math.floor(d/3600000);
    out.textContent=
      `${String(h2).padStart(2,'0')}:`+
      `${String(m).padStart(2,'0')}:`+
      `${String(s).padStart(2,'0')}`;
  }

  if(p>=1&&!finished){
    finished=true;
    ui.style.opacity=0;
    adv.classList.add('show');
    for(let i=0;i<120;i++)
      party.push({x:0,y:0,a:Math.random()*Math.PI*2,v:2+Math.random()*4,life:60});
  }

  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

// Fullscreen
const fsBtn=document.getElementById("fsBtn");
fsBtn.onclick=()=>{
  if(!document.fullscreenElement){
    document.documentElement.requestFullscreen();
    fsBtn.textContent="⤢ Exit";
  }else{
    document.exitFullscreen();
    fsBtn.textContent="⛶ Fullscreen";
  }
};
</script>
</body>
</html>
